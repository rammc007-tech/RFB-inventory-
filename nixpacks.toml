# Nixpacks configuration for Railway
# Industry-standard Next.js + Prisma deployment
# FIXED: Build works without DATABASE_URL

[phases.setup]
nixPkgs = ["nodejs-18_x"]

[phases.install]
cmds = ["npm ci --prefer-offline --no-audit || npm install --prefer-offline --no-audit"]

[phases.build]
cmds = [
  "echo 'ğŸ”§ Generating Prisma Client (no DB connection needed)...'",
  "npx prisma generate || echo 'âš ï¸ Prisma generate warning (continuing anyway)'",
  "echo 'ğŸ—ï¸ Building Next.js application...'",
  "NODE_ENV=production NEXTAUTH_URL=${NEXTAUTH_URL:-http://localhost:3000} NEXTAUTH_SECRET=${NEXTAUTH_SECRET:-temp-secret-for-build} next build || (echo 'âŒ Build failed' && exit 1)",
  "echo 'âœ… Build completed successfully!'"
]
