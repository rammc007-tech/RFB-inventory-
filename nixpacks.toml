# Nixpacks configuration for Railway
# FIXED: Uses build script to properly handle environment variables

[phases.setup]
nixPkgs = ["nodejs-18_x"]

[phases.install]
cmds = [
  "echo 'ğŸ“¦ Installing dependencies...'",
  "npm ci --prefer-offline --no-audit 2>&1 || npm install --prefer-offline --no-audit 2>&1 || echo 'âš ï¸ Install warning (continuing)'",
  "echo 'âœ… Dependencies installed'"
]

[phases.build]
cmds = [
  "echo 'ğŸ”§ Step 1: Generating Prisma Client...'",
  "npx prisma generate 2>&1 || echo 'âš ï¸ Prisma generate warning (continuing)'",
  "echo 'âœ… Prisma Client ready'",
  "echo 'ğŸ—ï¸ Step 2: Building Next.js...'",
  "NODE_ENV=production NEXTAUTH_URL=\"${NEXTAUTH_URL:-http://localhost:3000}\" NEXTAUTH_SECRET=\"${NEXTAUTH_SECRET:-temp-secret-for-build-only}\" DATABASE_URL=\"${DATABASE_URL:-postgresql://dummy:dummy@dummy:5432/dummy}\" next build 2>&1 || (echo 'âŒ Build failed' && exit 1)",
  "echo 'âœ… Build completed successfully!'"
]
